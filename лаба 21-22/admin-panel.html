<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Панель администратора</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&family=Jura:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.cdnfonts.com/css/eras-itc');
    
    body {
      margin: 0;
      font-family: 'Jura', sans-serif;
      background-image: url('images/background.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      position: relative;
      color: #333;
    }

    .back-button {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 50px;
      height: 50px;
      border: 1px solid #000;
      border-radius: 50%;
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      z-index: 1000;
    }

    .back-button:hover {
      background-color: #f0f0f0;
    }

    .back-button i {
      color: #000;
      font-size: 28px;
    }

    .page-title {
      text-align: center;
      font-size: 28px;
      font-weight: 700;
      color: #000;
      font-family: 'Jura', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 20px 0 30px 0;
    }

    .title-image {
      width: 50px;
      height: 50px;
      margin-right: 15px;
    }

    .admin-container {
      width: 96%;
      max-width: 1400px;
      background-color: #f0f0f0;
      border-radius: 0;
      padding: 30px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      margin-bottom: 30px;
    }

    .admin-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f8c8dc;
    }

    .admin-header h2 {
      font-size: 32px;
      color: #333;
      margin-bottom: 10px;
    }

    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      text-align: center;
    }

    .stat-card h3 {
      margin-top: 0;
      color: #f8c8dc;
      font-size: 24px;
    }

    .stat-number {
      font-size: 36px;
      font-weight: bold;
      color: #333;
    }

    .admin-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .admin-tab {
      padding: 12px 24px;
      background: white;
      border: 1px solid #000;
      border-radius: 0;
      cursor: pointer;
      font-family: 'Jura', sans-serif;
      font-size: 16px;
      transition: all 0.3s;
    }

    .admin-tab:hover {
      background: #f8c8dc;
    }

    .admin-tab.active {
      background: #f8c8dc;
      font-weight: bold;
    }

    .tab-content {
      display: none;
      background: white;
      padding: 30px;
      border-radius: 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .users-table, .appointments-table, .reviews-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .users-table th, .appointments-table th, .reviews-table th {
      background: #f8c8dc;
      padding: 12px;
      text-align: left;
      border: 1px solid #ddd;
    }

    .users-table td, .appointments-table td, .reviews-table td {
      padding: 12px;
      border: 1px solid #ddd;
    }

    .users-table tr:nth-child(even), 
    .appointments-table tr:nth-child(even),
    .reviews-table tr:nth-child(even) {
      background: #f9f9f9;
    }

    .status-active {
      color: green;
      font-weight: bold;
    }

    .status-blocked {
      color: red;
      font-weight: bold;
    }

    .btn-small {
      padding: 5px 10px;
      margin: 0 5px;
      border: 1px solid #000;
      background: white;
      cursor: pointer;
      font-family: 'Jura', sans-serif;
      border-radius: 0;
    }

    .btn-edit {
      background: #4CAF50;
      color: white;
    }

    .btn-delete {
      background: #f44336;
      color: white;
    }

    .btn-block {
      background: #ff9800;
      color: white;
    }

    .search-box {
      margin-bottom: 20px;
    }

    .search-box input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 0;
      font-family: 'Jura', sans-serif;
      font-size: 16px;
    }

    .logout-button {
      background-color: #ff6b6b;
      color: white;
      border: none;
      padding: 12px 25px;
      font-family: 'Jura', sans-serif;
      font-size: 16px;
      cursor: pointer;
      border-radius: 0;
      transition: background-color 0.3s ease;
      margin-top: 30px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .logout-button:hover {
      background-color: #ff5252;
    }

    .admin-warning {
      text-align: center;
      color: red;
      font-size: 18px;
      padding: 20px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .admin-stats {
        grid-template-columns: 1fr;
      }
      
      .admin-tabs {
        flex-direction: column;
      }
      
      .admin-tab {
        width: 100%;
      }
      
      .users-table, .appointments-table, .reviews-table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>

  <!-- Кнопка назад -->
  <a href="index.html" class="back-button">
    <i class="fas fa-reply"></i> 
  </a>

  <!-- Заголовок -->
  <div class="page-title">
    <img src="images/8.png" alt="Иконка" class="title-image">
    Панель администратора
  </div>

  <!-- Основной контейнер -->
  <div class="admin-container">
    
    <!-- Заголовок админ-панели -->
    <div class="admin-header" id="adminHeader">
      <h2>Добро пожаловать, Администратор</h2>
      <p>Последний вход: <span id="lastLogin"></span></p>
    </div>

    <!-- Статистика -->
    <div class="admin-stats" id="adminStats">
      <!-- Статистика будет загружена через JavaScript -->
    </div>

    <!-- Табы -->
    <div class="admin-tabs">
      <div class="admin-tab active" data-tab="users">Пользователи</div>
      <div class="admin-tab" data-tab="appointments">Записи</div>
      <div class="admin-tab" data-tab="reviews">Отзывы</div>
      <div class="admin-tab" data-tab="settings">Настройки</div>
    </div>

    <!-- Содержимое таба "Пользователи" -->
    <div class="tab-content active" id="users-tab">
      <h3>Управление пользователями</h3>
      <div class="search-box">
        <input type="text" id="userSearch" placeholder="Поиск по имени, телефону или email...">
      </div>
      <table class="users-table" id="usersTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Имя</th>
            <th>Телефон</th>
            <th>Роль</th>
            <th>Дата регистрации</th>
            <th>Статус</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <!-- Данные будут загружены через JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Содержимое таба "Записи" -->
    <div class="tab-content" id="appointments-tab">
      <h3>Все записи клиентов</h3>
      <div class="search-box">
        <input type="text" id="appointmentSearch" placeholder="Поиск по имени клиента или услуге...">
      </div>
      <table class="appointments-table" id="appointmentsTable">
        <thead>
          <tr>
            <th>ID записи</th>
            <th>Клиент</th>
            <th>Услуга</th>
            <th>Дата</th>
            <th>Время</th>
            <th>Цена</th>
            <th>Статус</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody id="appointmentsTableBody">
          <!-- Данные будут загружены через JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Содержимое таба "Отзывы" -->
    <div class="tab-content" id="reviews-tab">
      <h3>Управление отзывами</h3>
      <div class="search-box">
        <input type="text" id="reviewSearch" placeholder="Поиск по имени или отзыву...">
      </div>
      <table class="reviews-table" id="reviewsTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Пользователь</th>
            <th>Услуга</th>
            <th>Оценка</th>
            <th>Текст отзыва</th>
            <th>Дата</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody id="reviewsTableBody">
          <!-- Данные будут загружены через JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Содержимое таба "Настройки" -->
    <div class="tab-content" id="settings-tab">
      <h3>Настройки системы</h3>
      <div class="settings-container">
        <div class="stat-card">
          <h4>Секретный код администратора</h4>
          <p>Текущий код: <strong id="currentAdminCode">admin123</strong></p>
          <input type="text" id="newAdminCode" placeholder="Новый код">
          <button class="btn-small" onclick="updateAdminCode()">Изменить</button>
        </div>
        
        <div class="stat-card">
          <h4>Экспорт данных</h4>
          <p>Вы можете экспортировать все данные в JSON</p>
          <button class="btn-small" onclick="exportData()">Экспортировать все данные</button>
          <button class="btn-small" onclick="exportUsers()">Только пользователей</button>
        </div>
        
        <div class="stat-card">
          <h4>Резервное копирование</h4>
          <p>Создать резервную копию данных</p>
          <button class="btn-small" onclick="createBackup()">Создать backup</button>
        </div>
      </div>
    </div>

    <!-- Кнопка выхода -->
    <div style="text-align: center; margin-top: 40px;">
      <button id="logoutButton" class="logout-button">
        <i class="fas fa-sign-out-alt"></i> Выйти из админ-панели
      </button>
    </div>

  </div>

  <script>
    // ============ ПРОВЕРКА ДОСТУПА ============
    
    function checkAdminAccess() {
      const currentUser = getCurrentUser();
      
      if (!currentUser) {
        // Если пользователь не авторизован
        showAccessDenied('Пожалуйста, войдите в систему!');
        return false;
      }
      
      if (currentUser.role !== 'admin') {
        // Если пользователь не админ
        showAccessDenied('У вас нет доступа к админ-панели!');
        return false;
      }
      
      return true;
    }

    function showAccessDenied(message) {
      const container = document.querySelector('.admin-container');
      container.innerHTML = `
        <div class="admin-warning">
          <h3>⛔ Доступ запрещен</h3>
          <p>${message}</p>
          <p>Вы будете перенаправлены на главную страницу через 3 секунды...</p>
        </div>
      `;
      
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 3000);
    }

    // ============ ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ============
    
    function getCurrentUser() {
      const userJson = localStorage.getItem('currentUser');
      return userJson ? JSON.parse(userJson) : null;
    }

    function getAllUsers() {
      const usersJson = localStorage.getItem('beautySalonUsers');
      return usersJson ? JSON.parse(usersJson) : [];
    }

    function getAllAppointments() {
      const appointmentsJson = localStorage.getItem('beautySalonAppointments');
      return appointmentsJson ? JSON.parse(appointmentsJson) : [];
    }

    function getAllReviews() {
      const reviewsJson = localStorage.getItem('beautySalonReviews');
      return reviewsJson ? JSON.parse(reviewsJson) : {
        'Ресницы': [],
        'Брови': [],
        'Скайсы': []
      };
    }

    // ============ ЗАГРУЗКА СТАТИСТИКИ ============
    
    function loadStatistics() {
      const users = getAllUsers();
      const appointments = getAllAppointments();
      const reviews = getAllReviews();
      
      // Считаем статистику
      const totalUsers = users.length;
      const activeUsers = users.filter(u => !u.blocked).length;
      const adminsCount = users.filter(u => u.role === 'admin').length;
      
      // Считаем общее количество отзывов
      let totalReviews = 0;
      Object.values(reviews).forEach(category => {
        totalReviews += category.length;
      });
      
      const statsHTML = `
        <div class="stat-card">
          <h3><i class="fas fa-users"></i> Пользователи</h3>
          <div class="stat-number">${totalUsers}</div>
          <p>Активных: ${activeUsers}</p>
        </div>
        
        <div class="stat-card">
          <h3><i class="fas fa-calendar-check"></i> Записи</h3>
          <div class="stat-number">${appointments.length}</div>
          <p>За сегодня: 0</p>
        </div>
        
        <div class="stat-card">
          <h3><i class="fas fa-star"></i> Отзывы</h3>
          <div class="stat-number">${totalReviews}</div>
          <p>Средняя оценка: 4.8</p>
        </div>
        
        <div class="stat-card">
          <h3><i class="fas fa-user-shield"></i> Админы</h3>
          <div class="stat-number">${adminsCount}</div>
          <p>Из них онлайн: 1</p>
        </div>
      `;
      
      document.getElementById('adminStats').innerHTML = statsHTML;
    }

    // ============ ЗАГРУЗКА ПОЛЬЗОВАТЕЛЕЙ ============
    
    function loadUsers() {
      const users = getAllUsers();
      const currentUser = getCurrentUser();
      
      let usersHTML = '';
      
      users.forEach(user => {
        const isCurrentUser = currentUser && user.id === currentUser.id;
        const statusClass = user.blocked ? 'status-blocked' : 'status-active';
        const statusText = user.blocked ? 'Заблокирован' : 'Активен';
        
        usersHTML += `
          <tr>
            <td>${user.id}</td>
            <td>${user.firstName} ${user.lastName} ${isCurrentUser ? '(Вы)' : ''}</td>
            <td>${user.phone}</td>
            <td>${user.role === 'admin' ? 'Администратор' : 'Пользователь'}</td>
            <td>${user.registrationDate || 'Не указана'}</td>
            <td class="${statusClass}">${statusText}</td>
            <td>
              ${!isCurrentUser ? `
                <button class="btn-small btn-edit" onclick="editUser(${user.id})">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-small btn-block" onclick="toggleBlockUser(${user.id})">
                  ${user.blocked ? '<i class="fas fa-unlock"></i>' : '<i class="fas fa-lock"></i>'}
                </button>
                <button class="btn-small btn-delete" onclick="deleteUser(${user.id})">
                  <i class="fas fa-trash"></i>
                </button>
              ` : '<span>Текущий пользователь</span>'}
            </td>
          </tr>
        `;
      });
      
      document.getElementById('usersTableBody').innerHTML = usersHTML || `
        <tr>
          <td colspan="7" style="text-align: center;">Нет зарегистрированных пользователей</td>
        </tr>
      `;
    }

    // ============ ФУНКЦИИ УПРАВЛЕНИЯ ПОЛЬЗОВАТЕЛЯМИ ============
    
    function editUser(userId) {
      const users = getAllUsers();
      const user = users.find(u => u.id === userId);
      
      if (user) {
        const newFirstName = prompt('Введите новое имя:', user.firstName);
        const newLastName = prompt('Введите новую фамилию:', user.lastName);
        const newPhone = prompt('Введите новый телефон:', user.phone);
        
        if (newFirstName && newLastName && newPhone) {
          user.firstName = newFirstName;
          user.lastName = newLastName;
          user.phone = newPhone;
          
          localStorage.setItem('beautySalonUsers', JSON.stringify(users));
          loadUsers();
          alert('Данные пользователя обновлены!');
        }
      }
    }

    function toggleBlockUser(userId) {
      const users = getAllUsers();
      const user = users.find(u => u.id === userId);
      
      if (user) {
        user.blocked = !user.blocked;
        localStorage.setItem('beautySalonUsers', JSON.stringify(users));
        loadUsers();
        alert(`Пользователь ${user.blocked ? 'заблокирован' : 'разблокирован'}!`);
      }
    }

    function deleteUser(userId) {
      if (!confirm('Вы уверены, что хотите удалить этого пользователя?')) {
        return;
      }
      
      const users = getAllUsers();
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex !== -1) {
        // Нельзя удалить самого себя
        const currentUser = getCurrentUser();
        if (currentUser && users[userIndex].id === currentUser.id) {
          alert('Вы не можете удалить свой собственный аккаунт!');
          return;
        }
        
        users.splice(userIndex, 1);
        localStorage.setItem('beautySalonUsers', JSON.stringify(users));
        loadUsers();
        alert('Пользователь удален!');
      }
    }

    // ============ УПРАВЛЕНИЕ ВКЛАДКАМИ ============
    
    function setupAdminTabs() {
      const tabs = document.querySelectorAll('.admin-tab');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          
          // Убираем активный класс у всех табов
          tabs.forEach(t => t.classList.remove('active'));
          // Добавляем активный класс текущему табу
          this.classList.add('active');
          
          // Скрываем все контентные области
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          
          // Показываем выбранную область
          const contentId = `${tabId}-tab`;
          const contentElement = document.getElementById(contentId);
          if (contentElement) {
            contentElement.classList.add('active');
            
            // Загружаем данные для выбранной вкладки
            switch(tabId) {
              case 'users':
                loadUsers();
                break;
              case 'appointments':
                loadAppointments();
                break;
              case 'reviews':
                loadReviews();
                break;
            }
          }
        });
      });
    }

    // ============ ФУНКЦИИ ДЛЯ ОСТАЛЬНЫХ ВКЛАДОК ============
    
    function loadAppointments() {
      const appointments = getAllAppointments();
      const users = getAllUsers();
      
      // Если у вас еще нет системы хранения записей, создадим демо-данные
      if (appointments.length === 0) {
        const demoAppointments = [
          {
            id: 1,
            userId: 1,
            service: 'Наращивание ресниц 1D',
            date: '13 июня 2025',
            time: '13:45',
            price: '45 руб.',
            status: 'Подтверждена'
          },
          {
            id: 2,
            userId: 2,
            service: 'Коррекция бровей пинцетом',
            date: '21 июня 2025',
            time: '16:30',
            price: '20 руб.',
            status: 'Ожидание'
          }
        ];
        localStorage.setItem('beautySalonAppointments', JSON.stringify(demoAppointments));
      }
      
      const allAppointments = getAllAppointments();
      let appointmentsHTML = '';
      
      allAppointments.forEach(appointment => {
        const user = users.find(u => u.id === appointment.userId);
        const userName = user ? `${user.firstName} ${user.lastName}` : 'Неизвестный пользователь';
        
        appointmentsHTML += `
          <tr>
            <td>${appointment.id}</td>
            <td>${userName}</td>
            <td>${appointment.service}</td>
            <td>${appointment.date}</td>
            <td>${appointment.time}</td>
            <td>${appointment.price}</td>
            <td>${appointment.status}</td>
            <td>
              <button class="btn-small btn-edit" onclick="editAppointment(${appointment.id})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-small btn-delete" onclick="deleteAppointment(${appointment.id})">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      });
      
      document.getElementById('appointmentsTableBody').innerHTML = appointmentsHTML || `
        <tr>
          <td colspan="8" style="text-align: center;">Нет записей на процедуры</td>
        </tr>
      `;
    }

    function loadReviews() {
      const reviews = getAllReviews();
      const users = getAllUsers();
      
      let reviewsHTML = '';
      let reviewId = 1;
      
      // Собираем все отзывы из всех категорий
      Object.keys(reviews).forEach(category => {
        reviews[category].forEach(review => {
          const user = users.find(u => u.id === review.userId);
          const userName = user ? `${user.firstName} ${user.lastName}` : 'Аноним';
          
          reviewsHTML += `
            <tr>
              <td>${reviewId++}</td>
              <td>${userName}</td>
              <td>${category}</td>
              <td>${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</td>
              <td>${review.text.substring(0, 50)}${review.text.length > 50 ? '...' : ''}</td>
              <td>${review.date}</td>
              <td>
                <button class="btn-small btn-delete" onclick="deleteReview('${category}', ${reviewId - 2})">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          `;
        });
      });
      
      document.getElementById('reviewsTableBody').innerHTML = reviewsHTML || `
        <tr>
          <td colspan="7" style="text-align: center;">Нет отзывов</td>
        </tr>
      `;
    }

    // ============ ФУНКЦИИ НАСТРОЕК ============
    
    function updateAdminCode() {
      const newCode = document.getElementById('newAdminCode').value;
      if (newCode && newCode.length >= 6) {
        // В реальном проекте код должен храниться на сервере
        // Для демо просто показываем сообщение
        document.getElementById('currentAdminCode').textContent = newCode;
        document.getElementById('newAdminCode').value = '';
        alert('Секретный код обновлен!');
      } else {
        alert('Код должен содержать не менее 6 символов!');
      }
    }

    function exportData() {
      const data = {
        users: getAllUsers(),
        appointments: getAllAppointments(),
        reviews: getAllReviews(),
        exportDate: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = `beauty-salon-backup-${new Date().toISOString().split('T')[0]}.json`;
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
      
      alert('Данные успешно экспортированы!');
    }

    function exportUsers() {
      const users = getAllUsers();
      const dataStr = JSON.stringify(users, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = `beauty-salon-users-${new Date().toISOString().split('T')[0]}.json`;
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
    }

    function createBackup() {
      const backupData = {
        users: getAllUsers(),
        appointments: getAllAppointments(),
        reviews: getAllReviews(),
        timestamp: new Date().toISOString()
      };
      
      localStorage.setItem('beautySalonBackup', JSON.stringify(backupData));
      alert('Резервная копия создана!');
    }

    // ============ ПОИСК ============
    
    function setupSearch() {
      // Поиск пользователей
      document.getElementById('userSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#usersTableBody tr');
        
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
      });
      
      // Поиск записей
      document.getElementById('appointmentSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#appointmentsTableBody tr');
        
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
      });
      
      // Поиск отзывов
      document.getElementById('reviewSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#reviewsTableBody tr');
        
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
      });
    }

    // ============ ВЫХОД ИЗ СИСТЕМЫ ============
    
    function setupLogout() {
      document.getElementById('logoutButton').addEventListener('click', function() {
        if (confirm('Вы уверены, что хотите выйти из админ-панели?')) {
          // Выйти из админ-панели, но остаться в системе
          window.location.href = 'kabinet.html';
        }
      });
    }

    // ============ ИНИЦИАЛИЗАЦИЯ ПРИ ЗАГРУЗКЕ СТРАНИЦЫ ============
    
    document.addEventListener('DOMContentLoaded', function() {
      // Проверяем права доступа
      if (!checkAdminAccess()) {
        return;
      }
      
      // Загружаем данные текущего админа
      const currentUser = getCurrentUser();
      if (currentUser) {
        document.getElementById('adminHeader').querySelector('h2').textContent = 
          `Добро пожаловать, ${currentUser.firstName} (Администратор)`;
        
        if (currentUser.lastLogin) {
          document.getElementById('lastLogin').textContent = currentUser.lastLogin;
        }
      }
      
      // Загружаем статистику
      loadStatistics();
      
      // Загружаем пользователей
      loadUsers();
      
      // Настраиваем вкладки
      setupAdminTabs();
      
      // Настраиваем поиск
      setupSearch();
      
      // Настраиваем выход
      setupLogout();
      
      console.log('Админ-панель загружена');
    });
  </script>
</body>
</html>